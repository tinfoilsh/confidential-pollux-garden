shim-version: v0.3.5@sha256:f44c65a1f7db476be20c3431bb6facea8c2966606a07fbb5724a619f82bfa558
cvm-version: 0.5.15
cpus: 16
memory: 65536

containers:
  - name: "garden-app"
    image: ""
    args: [
      "-v", "/mnt/ramdisk/gcloud_key.json:/key.json:ro",
      "-e", "NODE_ENV=production",
      "-e", "NODE_OPTIONS=--max-old-space-size=28672",
      "-e", "GOOGLE_APPLICATION_CREDENTIALS=/key.json",
      "-e", "GCS_BUCKET=pollux-enc-prod",
      "-e", "POLLUX_LN_GCS_BUCKET=gs://pollux-enc-prod",
      "-e", "SYNC_SERVER_URL=pollux-sync-debug.inf6.tinfoil.sh",
      "-e", "EMBEDDING_SERVER_URL=pollux-embeddings-debug.inf6.tinfoil.sh",
      "-e", "TRAINING_SERVER_URL=https://pollux-training-debug.inf6.tinfoil.sh",
      "-e", "BETTER_AUTH_URL=https://pollux-garden-debug.inf6.tinfoil.sh",
      "-e", "DEBUG_ARTEFACT_CHAT=true",
      "-e", "EMAIL_VERIFY_ENABLED=false",
      "-e", "STAGING_DATABASE_URL=$(sed -n 's/^staging-database-url: *//p' /mnt/ramdisk/external-config.yml)",
      "-e", "DATABASE_URL=$(sed -n 's/^database-url: *//p' /mnt/ramdisk/external-config.yml)",
      "-e", "BETTER_AUTH_SECRET=$(awk -F': *' '$1~/^better-auth-secret$/{print $2; exit}' /mnt/ramdisk/external-config.yml)",
      "-e", "RESEND_API_KEY=$(awk -F': *' '$1~/^resend-api-key$/{print $2; exit}' /mnt/ramdisk/external-config.yml)",
      "-e", "RESEND_FROM_EMAIL=$(awk -F': *' '$1~/^resend-from-email$/{print $2; exit}' /mnt/ramdisk/external-config.yml)",
      "-e", "GOOGLE_CLIENT_ID=$(awk -F': *' '$1~/^google-client-id$/{print $2; exit}' /mnt/ramdisk/external-config.yml)",
      "-e", "GOOGLE_CLIENT_SECRET=$(awk -F': *' '$1~/^google-client-secret$/{print $2; exit}' /mnt/ramdisk/external-config.yml)",
      "-e", "NEXT_PUBLIC_GOOGLE_API_KEY=$(awk -F': *' '$1~/^next-public-google-api-key$/{print $2; exit}' /mnt/ramdisk/external-config.yml)",
      "-e", "EXA_API_KEY=$(awk -F': *' '$1~/^exa-api-key$/{print $2; exit}' /mnt/ramdisk/external-config.yml)",
      "-e", "TINFOIL_API_KEY=$(awk -F': *' '$1~/^tinfoil-api-key$/{print $2; exit}' /mnt/ramdisk/external-config.yml)",
      "-e", "ADMIN_API_KEY=$(awk -F': *' '$1~/^admin-api-key$/{print $2; exit}' /mnt/ramdisk/external-config.yml)",
      "us-central1-docker.pkg.dev/workshop-labs-pbc/garden-docker/app@sha256:9bf6ba484b60c6f84e4598eadad279831de3ef68d5291bbed823211a5962eca9"
    ]

shim:
  listen-port: 443
  upstream-port: 3000
